{"version":3,"sources":["../src/annyang.js"],"names":["root","factory","define","amd","annyang","module","exports","window","undefined","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","msSpeechRecognition","oSpeechRecognition","commandsList","recognition","callbacks","start","error","end","soundstart","result","resultMatch","resultNoMatch","errorNetwork","errorPermissionBlocked","errorPermissionDenied","autoRestart","lastStartedAt","autoRestartCount","debugState","debugStyle","pauseListening","isListening","optionalParam","optionalRegex","namedParam","splatParam","escapeRegExp","commandToRegExp","command","replace","match","optional","RegExp","invokeCallbacks","args","forEach","callback","apply","context","isInitialized","logMessage","text","extraParameters","indexOf","console","log","initIfNeeded","init","registerCommand","originalPhrase","push","parseResults","results","commandText","i","length","trim","j","l","currentCommand","exec","parameters","slice","addCommands","commands","cb","phrase","hasOwnProperty","regexp","source","options","paused","continuous","Date","getTime","e","message","abort","pause","resume","debug","newState","setLanguage","language","lang","removeCommands","commandsToRemove","Array","isArray","filter","addCallback","type","removeCallback","compareWithCallbackParameter","callbackType","getSpeechRecognizer","trigger","sentences","resetCommands","maxAlternatives","location","protocol","onstart","onsoundstart","onerror","event","onend","timeSinceLastStart","setTimeout","onresult","SpeechRecognitionResult","resultIndex","k","transcript"],"mappings":"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","file":"annyang.js","sourcesContent":["//! annyang\n//! version : 2.6.1\n//! author  : Tal Ater @TalAter\n//! license : MIT\n//! https://www.TalAter.com/annyang/\n(function(root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) { // AMD + global\n    define([], function () {\n      return (root.annyang = factory(root));\n    });\n  } else if (typeof module === 'object' && module.exports) { // CommonJS\n    module.exports = factory(root);\n  } else { // Browser globals\n    root.annyang = factory(root);\n  }\n})(typeof window !== 'undefined' ? window : this, function(root, undefined) {\n  'use strict';\n\n  /**\n   * # Quick Tutorial, Intro, and Demos\n   *\n   * The quickest way to get started is to visit the [annyang homepage](https://www.talater.com/annyang/).\n   *\n   * For a more in-depth look at annyang, read on.\n   *\n   * # API Reference\n   */\n\n  var annyang;\n\n  // Get the SpeechRecognition object, while handling browser prefixes\n  var SpeechRecognition = root.SpeechRecognition ||\n                          root.webkitSpeechRecognition ||\n                          root.mozSpeechRecognition ||\n                          root.msSpeechRecognition ||\n                          root.oSpeechRecognition;\n\n  // Check browser support\n  // This is done as early as possible, to make it as fast as possible for unsupported browsers\n  if (!SpeechRecognition) {\n    return null;\n  }\n\n  var commandsList = [];\n  var recognition;\n  var callbacks = {\n    start: [],\n    error: [],\n    end: [],\n    soundstart: [],\n    result: [],\n    resultMatch: [],\n    resultNoMatch: [],\n    errorNetwork: [],\n    errorPermissionBlocked: [],\n    errorPermissionDenied: [],\n  };\n  var autoRestart;\n  var lastStartedAt = 0;\n  var autoRestartCount = 0;\n  var debugState = false;\n  var debugStyle = 'font-weight: bold; color: #00f;';\n  var pauseListening = false;\n  var isListening = false;\n\n  // The command matching code is a modified version of Backbone.Router by Jeremy Ashkenas, under the MIT license.\n  var optionalParam = /\\s*\\((.*?)\\)\\s*/g;\n  var optionalRegex = /(\\(\\?:[^)]+\\))\\?/g;\n  var namedParam    = /(\\(\\?)?:\\w+/g;\n  var splatParam    = /\\*\\w+/g;\n  var escapeRegExp  = /[-{}[\\]+?.,\\\\^$|#]/g;\n  var commandToRegExp = function(command) {\n    command = command\n      .replace(escapeRegExp, '\\\\$&')\n      .replace(optionalParam, '(?:$1)?')\n      .replace(namedParam, function(match, optional) {\n        return optional ? match : '([^\\\\s]+)';\n      })\n      .replace(splatParam, '(.*?)')\n      .replace(optionalRegex, '\\\\s*$1?\\\\s*');\n    return new RegExp('^' + command + '$', 'i');\n  };\n\n  // This method receives an array of callbacks to iterate over, and invokes each of them\n  var invokeCallbacks = function(callbacks, ...args) {\n    callbacks.forEach(function(callback) {\n      callback.callback.apply(callback.context, args);\n    });\n  };\n\n  var isInitialized = function() {\n    return recognition !== undefined;\n  };\n\n  // method for logging in developer console when debug mode is on\n  var logMessage = function(text, extraParameters) {\n    if (text.indexOf('%c') === -1 && !extraParameters) {\n      console.log(text);\n    } else {\n      console.log(text, extraParameters || debugStyle);\n    }\n  };\n\n  var initIfNeeded = function() {\n    if (!isInitialized()) {\n      annyang.init({}, false);\n    }\n  };\n\n  var registerCommand = function(command, callback, originalPhrase) {\n    commandsList.push({ command, callback, originalPhrase });\n    if (debugState) {\n      logMessage(\n        'Command successfully loaded: %c' + originalPhrase,\n        debugStyle\n      );\n    }\n  };\n\n  var parseResults = function(results) {\n    invokeCallbacks(callbacks.result, results);\n    var commandText;\n    // go over each of the 5 results and alternative results received (we have set maxAlternatives to 5 above)\n    for (let i = 0; i < results.length; i++) {\n      // the text recognized\n      commandText = results[i].trim();\n      if (debugState) {\n        logMessage('Speech recognized: %c' + commandText, debugStyle);\n      }\n\n      // try and match recognized text to one of the commands on the list\n      for (let j = 0, l = commandsList.length; j < l; j++) {\n        var currentCommand = commandsList[j];\n        var result = currentCommand.command.exec(commandText);\n        if (result) {\n          var parameters = result.slice(1);\n          if (debugState) {\n            logMessage(\n              'command matched: %c' + currentCommand.originalPhrase,\n              debugStyle\n            );\n            if (parameters.length) {\n              logMessage('with parameters', parameters);\n            }\n          }\n          // execute the matched command\n          currentCommand.callback.apply(this, parameters);\n          invokeCallbacks(\n            callbacks.resultMatch,\n            commandText,\n            currentCommand.originalPhrase,\n            results\n          );\n          return;\n        }\n      }\n    }\n    invokeCallbacks(callbacks.resultNoMatch, results);\n  };\n\n  annyang = {\n    /**\n     * Add commands that annyang will respond to. Similar in syntax to init(), but doesn't remove existing commands.\n     *\n     * #### Examples:\n     * ````javascript\n     * const commands = {'hello :name': helloFunction, 'howdy': helloFunction};\n     * const commands2 = {'hi': helloFunction};\n     *\n     * annyang.addCommands(commands);\n     * annyang.addCommands(commands2);\n     * // annyang will now listen to all three commands\n     * ````\n     *\n     * @param {Object} commands - Commands that annyang should listen to\n     * @method addCommands\n     * @see [Commands Object](#commands-object)\n     */\n    addCommands: function(commands) {\n      var cb;\n\n      initIfNeeded();\n\n      for (let phrase in commands) {\n        if (commands.hasOwnProperty(phrase)) {\n          cb = root[commands[phrase]] || commands[phrase];\n          if (typeof cb === 'function') {\n            // convert command to regex then register the command\n            registerCommand(commandToRegExp(phrase), cb, phrase);\n          } else if (typeof cb === 'object' && cb.regexp instanceof RegExp) {\n            // register the command\n            registerCommand(\n              new RegExp(cb.regexp.source, 'i'),\n              cb.callback,\n              phrase\n            );\n          } else {\n            if (debugState) {\n              logMessage('Can not register command: %c' + phrase, debugStyle);\n            }\n            continue;\n          }\n        }\n      }\n    },\n\n    /**\n     * Start listening.\n     * It's a good idea to call this after adding some commands first, but not mandatory.\n     *\n     * Receives an optional options object which supports the following options:\n     *\n     * - `autoRestart`  (boolean) Should annyang restart itself if it is closed indirectly, because of silence or window conflicts?\n     * - `continuous`   (boolean) Allow forcing continuous mode on or off. Annyang is pretty smart about this, so only set this if you know what you're doing.\n     * - `paused`       (boolean) Start annyang in paused mode.\n     *\n     * #### Examples:\n     * ````javascript\n     * // Start listening, don't restart automatically\n     * annyang.start({ autoRestart: false });\n     * // Start listening, don't restart automatically, stop recognition after first phrase recognized\n     * annyang.start({ autoRestart: false, continuous: false });\n     * ````\n     * @param {Object} [options] - Optional options.\n     * @method start\n     */\n    start: function(options) {\n      initIfNeeded();\n      options = options || {};\n      if (options.paused !== undefined) {\n        pauseListening = !!options.paused;\n      } else {\n        pauseListening = false;\n      }\n      if (options.autoRestart !== undefined) {\n        autoRestart = !!options.autoRestart;\n      } else {\n        autoRestart = true;\n      }\n      if (options.continuous !== undefined) {\n        recognition.continuous = !!options.continuous;\n      }\n\n      lastStartedAt = new Date().getTime();\n      try {\n        recognition.start();\n      } catch (e) {\n        if (debugState) {\n          logMessage(e.message);\n        }\n      }\n    },\n\n    /**\n     * Stop listening, and turn off mic.\n     *\n     * Alternatively, to only temporarily pause annyang responding to commands without stopping the SpeechRecognition engine or closing the mic, use pause() instead.\n     * @see [pause()](#pause)\n     *\n     * @method abort\n     */\n    abort: function() {\n      autoRestart = false;\n      autoRestartCount = 0;\n      if (isInitialized()) {\n        recognition.abort();\n      }\n    },\n\n    /**\n     * Pause listening. annyang will stop responding to commands (until the resume or start methods are called), without turning off the browser's SpeechRecognition engine or the mic.\n     *\n     * Alternatively, to stop the SpeechRecognition engine and close the mic, use abort() instead.\n     * @see [abort()](#abort)\n     *\n     * @method pause\n     */\n    pause: function() {\n      pauseListening = true;\n    },\n\n    /**\n     * Resumes listening and restore command callback execution when a result matches.\n     * If SpeechRecognition was aborted (stopped), start it.\n     *\n     * @method resume\n     */\n    resume: function() {\n      annyang.start();\n    },\n\n    /**\n     * Turn on the output of debug messages to the console. Ugly, but super-handy!\n     *\n     * @param {boolean} [newState=true] - Turn on/off debug messages\n     * @method debug\n     */\n    debug: function(newState = true) {\n      debugState = !!newState;\n    },\n\n    /**\n     * Set the language the user will speak in. If this method is not called, defaults to 'en-US'.\n     *\n     * @param {String} language - The language (locale)\n     * @method setLanguage\n     * @see [Languages](https://github.com/TalAter/annyang/blob/master/docs/FAQ.md#what-languages-are-supported)\n     */\n    setLanguage: function(language) {\n      initIfNeeded();\n      recognition.lang = language;\n    },\n\n    /**\n     * Remove existing commands. Called with a single phrase, an array of phrases, or methodically. Pass no params to remove all commands.\n     *\n     * #### Examples:\n     * ````javascript\n     * const commands = {'hello': helloFunction, 'howdy': helloFunction, 'hi': helloFunction};\n     *\n     * // Remove all existing commands\n     * annyang.removeCommands();\n     *\n     * // Add some commands\n     * annyang.addCommands(commands);\n     *\n     * // Don't respond to hello\n     * annyang.removeCommands('hello');\n     *\n     * // Don't respond to howdy or hi\n     * annyang.removeCommands(['howdy', 'hi']);\n     * ````\n     * @param {String|Array|Undefined} [commandsToRemove] - Commands to remove\n     * @method removeCommands\n     */\n    removeCommands: function(commandsToRemove) {\n      if (commandsToRemove === undefined) {\n        commandsList = [];\n      } else {\n        commandsToRemove = Array.isArray(commandsToRemove) ? commandsToRemove : [commandsToRemove];\n        commandsList = commandsList.filter(command => {\n          for (let i = 0; i < commandsToRemove.length; i++) {\n            if (commandsToRemove[i] === command.originalPhrase) {\n              return false;\n            }\n          }\n          return true;\n        });\n      }\n    },\n\n    /**\n     * Add a callback function to be called in case one of the following events happens:\n     *\n     * * `start` - Fired as soon as the browser's Speech Recognition engine starts listening.\n     *\n     * * `soundstart` - Fired as soon as any sound (possibly speech) has been detected.\n     *\n     *     This will fire once per Speech Recognition starting. See https://is.gd/annyang_sound_start.\n     *\n     * * `error` - Fired when the browser's Speech Recognition engine returns an error, this generic error callback will be followed by more accurate error callbacks (both will fire if both are defined).\n     *\n     *     The Callback function will be called with the error event as the first argument.\n     *\n     * * `errorNetwork` - Fired when Speech Recognition fails because of a network error.\n     *\n     *     The Callback function will be called with the error event as the first argument.\n     *\n     * * `errorPermissionBlocked` - Fired when the browser blocks the permission request to use Speech Recognition.\n     *\n     *     The Callback function will be called with the error event as the first argument.\n     *\n     * * `errorPermissionDenied` - Fired when the user blocks the permission request to use Speech Recognition.\n     *\n     *     The Callback function will be called with the error event as the first argument.\n     *\n     * * `end` - Fired when the browser's Speech Recognition engine stops.\n     *\n     * * `result` - Fired as soon as some speech was identified. This generic callback will be followed by either the `resultMatch` or `resultNoMatch` callbacks.\n     *\n     *     The Callback functions for this event will be called with an array of possible phrases the user said as the first argument.\n     *\n     * * `resultMatch` - Fired when annyang was able to match between what the user said and a registered command.\n     *\n     *     The Callback functions for this event will be called with three arguments in the following order:\n     *\n     *     * The phrase the user said that matched a command.\n     *     * The command that was matched.\n     *     * An array of possible alternative phrases the user might have said.\n     *\n     * * `resultNoMatch` - Fired when what the user said didn't match any of the registered commands.\n     *\n     *     Callback functions for this event will be called with an array of possible phrases the user might have said as the first argument.\n     *\n     * #### Examples:\n     * ````javascript\n     * annyang.addCallback('error', function() {\n     *   $('.myErrorText').text('There was an error!');\n     * });\n     *\n     * annyang.addCallback('resultMatch', function(userSaid, commandText, phrases) {\n     *   console.log(userSaid); // sample output: 'hello'\n     *   console.log(commandText); // sample output: 'hello (there)'\n     *   console.log(phrases); // sample output: ['hello', 'halo', 'yellow', 'polo', 'hello kitty']\n     * });\n     *\n     * // pass local context to a global function called notConnected\n     * annyang.addCallback('errorNetwork', notConnected, this);\n     * ````\n     * @param {String} type - Name of event that will trigger this callback\n     * @param {Function} callback - The function to call when event is triggered\n     * @param {Object} [context] - Optional context for the callback function\n     * @method addCallback\n     */\n    addCallback: function(type, callback, context) {\n      var cb = root[callback] || callback;\n      if (typeof cb === 'function' && callbacks[type] !== undefined) {\n        callbacks[type].push({ callback: cb, context: context || this });\n      }\n    },\n\n    /**\n     * Remove callbacks from events.\n     *\n     * - Pass an event name and a callback command to remove that callback command from that event type.\n     * - Pass just an event name to remove all callback commands from that event type.\n     * - Pass undefined as event name and a callback command to remove that callback command from all event types.\n     * - Pass no params to remove all callback commands from all event types.\n     *\n     * #### Examples:\n     * ````javascript\n     * annyang.addCallback('start', myFunction1);\n     * annyang.addCallback('start', myFunction2);\n     * annyang.addCallback('end', myFunction1);\n     * annyang.addCallback('end', myFunction2);\n     *\n     * // Remove all callbacks from all events:\n     * annyang.removeCallback();\n     *\n     * // Remove all callbacks attached to end event:\n     * annyang.removeCallback('end');\n     *\n     * // Remove myFunction2 from being called on start:\n     * annyang.removeCallback('start', myFunction2);\n     *\n     * // Remove myFunction1 from being called on all events:\n     * annyang.removeCallback(undefined, myFunction1);\n     * ````\n     *\n     * @param type Name of event type to remove callback from\n     * @param callback The callback function to remove\n     * @returns undefined\n     * @method removeCallback\n     */\n    removeCallback: function(type, callback) {\n      var compareWithCallbackParameter = function(cb) {\n        return cb.callback !== callback;\n      };\n      // Go over each callback type in callbacks store object\n      for (let callbackType in callbacks) {\n        if (callbacks.hasOwnProperty(callbackType)) {\n          // if this is the type user asked to delete, or he asked to delete all, go ahead.\n          if (type === undefined || type === callbackType) {\n            // If user asked to delete all callbacks in this type or all types\n            if (callback === undefined) {\n              callbacks[callbackType] = [];\n            } else {\n              // Remove all matching callbacks\n              callbacks[callbackType] = callbacks[callbackType].filter(compareWithCallbackParameter);\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Returns true if speech recognition is currently on.\n     * Returns false if speech recognition is off or annyang is paused.\n     *\n     * @return boolean true = SpeechRecognition is on and annyang is listening\n     * @method isListening\n     */\n    isListening: function() {\n      return isListening && !pauseListening;\n    },\n\n    /**\n     * Returns the instance of the browser's SpeechRecognition object used by annyang.\n     * Useful in case you want direct access to the browser's Speech Recognition engine.\n     *\n     * @returns SpeechRecognition The browser's Speech Recognizer currently used by annyang\n     * @method getSpeechRecognizer\n     */\n    getSpeechRecognizer: function() {\n      return recognition;\n    },\n\n    /**\n     * Simulate speech being recognized. This will trigger the same events and behavior as when the Speech Recognition\n     * detects speech.\n     *\n     * Can accept either a string containing a single sentence or an array containing multiple sentences to be checked\n     * in order until one of them matches a command (similar to the way Speech Recognition Alternatives are parsed)\n     *\n     * #### Examples:\n     * ````javascript\n     * annyang.trigger('Time for some thrilling heroics');\n     * annyang.trigger(\n     *     ['Time for some thrilling heroics', 'Time for some thrilling aerobics']\n     *   );\n     * ````\n     *\n     * @param string|array sentences A sentence as a string or an array of strings of possible sentences\n     * @returns undefined\n     * @method trigger\n     */\n    trigger: function(sentences) {\n      if (!annyang.isListening()) {\n        if (debugState) {\n          if (!isListening) {\n            logMessage('Cannot trigger while annyang is aborted');\n          } else {\n            logMessage('Speech heard, but annyang is paused');\n          }\n        }\n        return;\n      }\n\n      if (!Array.isArray(sentences)) {\n        sentences = [sentences];\n      }\n\n      parseResults(sentences);\n    },\n\n    /**\n     * Initialize annyang with a list of commands to recognize.\n     *\n     * #### Examples:\n     * ````javascript\n     * const commands = {'hello :name': helloFunction};\n     * const commands2 = {'hi': helloFunction};\n     *\n     * // initialize annyang, overwriting any previously added commands\n     * annyang.init(commands, true);\n     * // adds an additional command without removing the previous commands\n     * annyang.init(commands2, false);\n     * ````\n     * As of v1.1.0 it is no longer required to call init(). Just start() listening whenever you want, and addCommands() whenever, and as often as you like.\n     *\n     * @param {Object} commands - Commands that annyang should listen to\n     * @param {boolean} [resetCommands=true] - Remove all commands before initializing?\n     * @method init\n     * @deprecated\n     * @see [Commands Object](#commands-object)\n     */\n    init: function(commands, resetCommands = true) {\n      // Abort previous instances of recognition already running\n      if (recognition && recognition.abort) {\n        recognition.abort();\n      }\n\n      // initiate SpeechRecognition\n      recognition = new SpeechRecognition();\n\n      // Set the max number of alternative transcripts to try and match with a command\n      recognition.maxAlternatives = 5;\n\n      // In HTTPS, turn off continuous mode for faster results.\n      // In HTTP,  turn on  continuous mode for much slower results, but no repeating security notices\n      recognition.continuous = root.location.protocol === 'http:';\n\n      // Sets the language to the default 'en-US'. This can be changed with annyang.setLanguage()\n      recognition.lang = 'en-US';\n\n      recognition.onstart = function() {\n        isListening = true;\n        invokeCallbacks(callbacks.start);\n      };\n\n      recognition.onsoundstart = function() {\n        invokeCallbacks(callbacks.soundstart);\n      };\n\n      recognition.onerror = function(event) {\n        invokeCallbacks(callbacks.error, event);\n        switch (event.error) {\n          case 'network':\n            invokeCallbacks(callbacks.errorNetwork, event);\n            break;\n          case 'not-allowed':\n          case 'service-not-allowed':\n            // if permission to use the mic is denied, turn off auto-restart\n            autoRestart = false;\n            // determine if permission was denied by user or automatically.\n            if (new Date().getTime() - lastStartedAt < 200) {\n              invokeCallbacks(callbacks.errorPermissionBlocked, event);\n            } else {\n              invokeCallbacks(callbacks.errorPermissionDenied, event);\n            }\n            break;\n        }\n      };\n\n      recognition.onend = function() {\n        isListening = false;\n        invokeCallbacks(callbacks.end);\n        // annyang will auto restart if it is closed automatically and not by user action.\n        if (autoRestart) {\n          // play nicely with the browser, and never restart annyang automatically more than once per second\n          var timeSinceLastStart = new Date().getTime() - lastStartedAt;\n          autoRestartCount += 1;\n          if (autoRestartCount % 10 === 0) {\n            if (debugState) {\n              logMessage(\n                'Speech Recognition is repeatedly stopping and starting. See http://is.gd/annyang_restarts for tips.'\n              );\n            }\n          }\n          if (timeSinceLastStart < 1000) {\n            setTimeout(function() {\n              annyang.start({ paused: pauseListening });\n            }, 1000 - timeSinceLastStart);\n          } else {\n            annyang.start({ paused: pauseListening });\n          }\n        }\n      };\n\n      recognition.onresult = function(event) {\n        if (pauseListening) {\n          if (debugState) {\n            logMessage('Speech heard, but annyang is paused');\n          }\n          return false;\n        }\n\n        // Map the results to an array\n        var SpeechRecognitionResult = event.results[event.resultIndex];\n        var results = [];\n        for (let k = 0; k < SpeechRecognitionResult.length; k++) {\n          results[k] = SpeechRecognitionResult[k].transcript;\n        }\n\n        parseResults(results);\n      };\n\n      // build commands list\n      if (resetCommands) {\n        commandsList = [];\n      }\n      if (commands.length) {\n        this.addCommands(commands);\n      }\n    },\n  };\n\n  return annyang;\n});\n\n/**\n * # Good to Know\n *\n * ## Commands Object\n *\n * Both the [init()]() and addCommands() methods receive a `commands` object.\n *\n * annyang understands commands with `named variables`, `splats`, and `optional words`.\n *\n * * Use `named variables` for one-word arguments in your command.\n * * Use `splats` to capture multi-word text at the end of your command (greedy).\n * * Use `optional words` or phrases to define a part of the command as optional.\n *\n * #### Examples:\n * ````html\n * <script>\n * const commands = {\n *   // annyang will capture anything after a splat (*) and pass it to the function.\n *   // e.g. saying \"Show me Batman and Robin\" will call showFlickr('Batman and Robin');\n *   'show me *tag': showFlickr,\n *\n *   // A named variable is a one-word variable, that can fit anywhere in your command.\n *   // e.g. saying \"calculate October stats\" will call calculateStats('October');\n *   'calculate :month stats': calculateStats,\n *\n *   // By defining a part of the following command as optional, annyang will respond\n *   // to both: \"say hello to my little friend\" as well as \"say hello friend\"\n *   'say hello (to my little) friend': greeting\n * };\n *\n * const showFlickr = function(tag) {\n *   var url = 'http://api.flickr.com/services/rest/?tags='+tag;\n *   $.getJSON(url);\n * }\n *\n * const calculateStats = function(month) {\n *   $('#stats').text('Statistics for '+month);\n * }\n *\n * const greeting = function() {\n *   $('#greeting').text('Hello!');\n * }\n * </script>\n * ````\n *\n * ### Using Regular Expressions in commands\n * For advanced commands, you can pass a regular expression object, instead of\n * a simple string command.\n *\n * This is done by passing an object containing two properties: `regexp`, and\n * `callback` instead of the function.\n *\n * #### Examples:\n * ````javascript\n * const calculateFunction = function(month) { console.log(month); }\n * const commands = {\n *   // This example will accept any word as the \"month\"\n *   'calculate :month stats': calculateFunction,\n *   // This example will only accept months which are at the start of a quarter\n *   'calculate :quarter stats': {'regexp': /^calculate (January|April|July|October) stats$/, 'callback': calculateFunction}\n * }\n ````\n *\n */\n"]}